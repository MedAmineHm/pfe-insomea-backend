apiVersion: batch/v1
kind: Job
metadata:
  name: infracost-job
spec:
  template:
    spec:
      containers:
        - name: infracost
          image: mohamedamine1/backend:backend-pfe
          command:
            [
              'sh',
              '-c',
              'infracost breakdown --path=/terraform-codes/terraform --format=json --out-file=/data/infracost.json',
            ]
          env:
            - name: INFRACOST_API_KEY
              value: 'ico-Vl2mxmC2iGdpEQQkwwqmjIkhjZjiJbnF'
          volumeMounts:
            - name: terraform-data
              mountPath: /terraform-codes
            - name: infracost-data
              mountPath: /data
      volumes:
        - name: terraform-data
          persistentVolumeClaim:
            claimName: terraform-pvc
        - name: infracost-data
          persistentVolumeClaim:
            claimName: infracost-pvc
      restartPolicy: OnFailure
