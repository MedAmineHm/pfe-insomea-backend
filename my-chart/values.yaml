apiVersion: argoproj.io/v1alpha1
kind: HelmRelease
metadata:
  name: nestjs-mongodb-redis
spec:
  chart:
    repository: https://charts.example.com/stable
    version: 1.0.0
  releases:
    # Release for Nest.js application
    - name: my-nest-app
      chart: my-nest-app
      values:
        replicaCount: 3
        image:
          repository: mohamedamine1/backend
          tag: backend-pfe
          pullPolicy: IfNotPresent
        service:
          name: my-nest-app-service
          type: LoadBalancer
          port: 80
        env:
          - name: MONGO_URI
            value: 'mongodb://amine:Hamidou123@mongodb-service:27017/?retryWrites=true&w=majority&appName=Cluster0'
          - name: REDIS_HOST
            value: redis
          - name: REDIS_PORT
            value: '6379'

    # Release for MongoDB
    - name: mongodb
      chart: mongodb
      values:
        replicaCount: 1
        image:
          repository: mongo
          tag: latest
          pullPolicy: IfNotPresent
        env:
          - name: MONGO_INITDB_ROOT_USERNAME
            value: amine
          - name: MONGO_INITDB_ROOT_PASSWORD
            value: Hamidou123

    # Release for Redis
    - name: redis
      chart: redis
      values:
        replicaCount: 1
        image:
          repository: redis
          tag: latest
          pullPolicy: IfNotPresent
        service:
          name: redis-service
          type: LoadBalancer
          port: 6379
